semanticModel:
  version: 1.0
  name: tpch_semantic_model
  description: TPC-H Order Analytics Semantic Model

# Tables
tables:
  - name: fact_order_line
    description: Order line item fact table with detailed transaction metrics
    sql_table_name: fact_order_line
    
    dimensions:
      - name: order_header_id
        type: number
        sql: ${TABLE}.order_header_id
        primary_key: true
      
      - name: line_number
        type: number
        sql: ${TABLE}.line_number
        primary_key: true
      
      - name: ship_mode
        type: string
        sql: ${TABLE}.ship_mode
        tags:
          - shipping
          - logistics
    
    measures:
      - name: total_orders
        description: Count of distinct orders
        type: count_distinct
        sql: ${TABLE}.order_header_id
        format: "#,##0"
        tags:
          - orders
          - kpi
      
      - name: total_line_items
        description: Count of all order line items
        type: count
        tags:
          - orders
      
      - name: total_quantity
        description: Sum of quantity ordered
        type: sum
        sql: ${TABLE}.quantity
        format: "#,##0"
        tags:
          - volume
          - kpi
      
      - name: total_extended_amount
        description: Total extended price before discounts
        type: sum
        sql: ${TABLE}.extended_amount
        format: "$#,##0.00"
        tags:
          - revenue
          - financial
      
      - name: total_discount_amount
        description: Total discount amount given
        type: sum
        sql: ${TABLE}.discount_amount
        format: "$#,##0.00"
        tags:
          - discount
          - financial
      
      - name: total_net_amount
        description: Net amount after discounts
        type: sum
        sql: ${TABLE}.net_amount
        format: "$#,##0.00"
        tags:
          - revenue
          - financial
          - kpi
      
      - name: total_gross_revenue
        description: Gross revenue including tax
        type: sum
        sql: ${TABLE}.gross_revenue
        format: "$#,##0.00"
        tags:
          - revenue
          - financial
          - kpi
      
      - name: avg_discount_rate
        description: Average discount rate applied
        type: avg
        sql: ${TABLE}.discount_rate
        format: "0.0%"
        tags:
          - discount
          - pricing
      
      - name: avg_order_value
        description: Average net amount per order
        type: number
        sql: ${total_net_amount} / NULLIF(${total_orders}, 0)
        format: "$#,##0.00"
        tags:
          - kpi
          - financial
      
      - name: avg_items_per_order
        description: Average number of line items per order
        type: number
        sql: ${total_line_items} / NULLIF(${total_orders}, 0)
        format: "0.0"
        tags:
          - kpi
          - orders

  - name: dim_customer
    description: Customer dimension with geographic information
    sql_table_name: dim_customer
    
    dimensions:
      - name: customer_id
        type: number
        sql: ${TABLE}.customer_id
        primary_key: true
      
      - name: customer_name
        type: string
        sql: ${TABLE}.customer_name
        tags:
          - customer
      
      - name: market_segment
        type: string
        sql: ${TABLE}.market_segment
        tags:
          - customer
          - segmentation
      
      - name: nation
        type: string
        sql: ${TABLE}.nation
        tags:
          - geography
      
      - name: region
        type: string
        sql: ${TABLE}.region
        tags:
          - geography
      
      - name: account_balance
        type: number
        sql: ${TABLE}.account_balance
        format: "$#,##0.00"
        tags:
          - customer
          - financial

  - name: dim_date
    description: Date dimension for time-based analysis
    sql_table_name: dim_date
    
    dimensions:
      - name: date_id
        type: number
        sql: ${TABLE}.date_id
        primary_key: true
      
      - name: date_key
        type: date
        sql: ${TABLE}.date_key
        tags:
          - time
      
      - name: year
        type: number
        sql: ${TABLE}.year
        tags:
          - time
          - hierarchy
      
      - name: quarter
        type: number
        sql: ${TABLE}.quarter
        tags:
          - time
          - hierarchy
      
      - name: month
        type: number
        sql: ${TABLE}.month
        tags:
          - time
          - hierarchy
      
      - name: day
        type: number
        sql: ${TABLE}.day
        tags:
          - time
      
      - name: weekday_name
        type: string
        sql: ${TABLE}.weekday_name
        tags:
          - time
      
      - name: is_weekend
        type: boolean
        sql: ${TABLE}.is_weekend
        tags:
          - time

  - name: dim_part
    description: Part/product dimension
    sql_table_name: dim_part
    
    dimensions:
      - name: part_id
        type: number
        sql: ${TABLE}.part_id
        primary_key: true
      
      - name: part_name
        type: string
        sql: ${TABLE}.part_name
        tags:
          - product
      
      - name: brand
        type: string
        sql: ${TABLE}.brand
        tags:
          - product
          - branding
      
      - name: part_type
        type: string
        sql: ${TABLE}.part_type
        tags:
          - product
          - classification
      
      - name: part_size
        type: number
        sql: ${TABLE}.part_size
        tags:
          - product
      
      - name: container
        type: string
        sql: ${TABLE}.container
        tags:
          - product
          - packaging
      
      - name: retail_price
        type: number
        sql: ${TABLE}.retail_price
        format: "$#,##0.00"
        tags:
          - product
          - pricing

  - name: dim_supplier
    description: Supplier dimension with geographic information
    sql_table_name: dim_supplier
    
    dimensions:
      - name: supplier_id
        type: number
        sql: ${TABLE}.supplier_id
        primary_key: true
      
      - name: supplier_name
        type: string
        sql: ${TABLE}.supplier_name
        tags:
          - supplier
      
      - name: nation
        type: string
        sql: ${TABLE}.nation
        tags:
          - geography
          - supplier
      
      - name: region
        type: string
        sql: ${TABLE}.region
        tags:
          - geography
          - supplier
      
      - name: account_balance
        type: number
        sql: ${TABLE}.account_balance
        format: "$#,##0.00"
        tags:
          - supplier
          - financial

  - name: dim_order_header
    description: Order header dimension
    sql_table_name: dim_order_header
    
    dimensions:
      - name: order_header_id
        type: number
        sql: ${TABLE}.order_header_id
        primary_key: true
      
      - name: order_key
        type: number
        sql: ${TABLE}.order_key
        tags:
          - orders
      
      - name: order_status
        type: string
        sql: ${TABLE}.order_status
        tags:
          - orders
          - status
      
      - name: order_priority
        type: string
        sql: ${TABLE}.order_priority
        tags:
          - orders
          - priority
      
      - name: clerk_name
        type: string
        sql: ${TABLE}.clerk_name
        tags:
          - orders
          - personnel

# Joins/Relationships
joins:
  - name: fact_to_customer
    type: left_outer
    sql_on: ${fact_order_line.customer_id} = ${dim_customer.customer_id}
    relationship: many_to_one
    
  - name: fact_to_ship_date
    type: left_outer
    sql_on: ${fact_order_line.ship_date_id} = ${dim_date.date_id}
    relationship: many_to_one
    
  - name: fact_to_commit_date
    type: left_outer
    sql_on: ${fact_order_line.commit_date_id} = ${dim_date.date_id}
    relationship: many_to_one
    
  - name: fact_to_receipt_date
    type: left_outer
    sql_on: ${fact_order_line.receipt_date_id} = ${dim_date.date_id}
    relationship: many_to_one
    
  - name: fact_to_part
    type: left_outer
    sql_on: ${fact_order_line.part_id} = ${dim_part.part_id}
    relationship: many_to_one
    
  - name: fact_to_supplier
    type: left_outer
    sql_on: ${fact_order_line.supplier_id} = ${dim_supplier.supplier_id}
    relationship: many_to_one
    
  - name: fact_to_order_header
    type: left_outer
    sql_on: ${fact_order_line.order_header_id} = ${dim_order_header.order_header_id}
    relationship: many_to_one

# Metadata
metadata:
  tags:
    - kpi: Key Performance Indicator
    - financial: Financial metric
    - revenue: Revenue-related metric
    - orders: Order-related dimension or metric
    - customer: Customer-related dimension
    - product: Product-related dimension
    - supplier: Supplier-related dimension
    - geography: Geographic dimension
    - time: Time-related dimension
    - hierarchy: Part of a hierarchical structure
